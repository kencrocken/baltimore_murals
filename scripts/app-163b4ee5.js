"use strict";angular.module("baltimoreMurals",["ngResource","ui.router","uiGmapgoogle-maps"]).config(["$stateProvider","$urlRouterProvider",function(e,i){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}),i.otherwise("/")}]),angular.module("baltimoreMurals").controller("NavbarCtrl",["$scope",function(e){e.date=new Date}]),angular.module("baltimoreMurals").controller("InfoWindowCtrl",["$scope","uiGmapGoogleMapApi","Murals",function(e,i,t){console.log("INFOWINDOW CONTROLLER!");var a=function(){return t.getMural()};a().length>0&&(a=a(),e.mural=a[0],console.log(e.mural)),e.addFavorite=function(e){e.isFavorite=!0,console.log(e.isFavorite)},e.removeFavorite=function(e){e.isFavorite=!1,console.log(e.isFavorite)}}]),angular.module("baltimoreMurals").controller("MainCtrl",["$scope","$window","uiGmapGoogleMapApi","Murals","preloader",function(e,i,t,a,o){e.data,e.percentLoaded=0,e.markers=[],e.imageLocations=[],e.isLoading=!0,e.isSuccessful=!1,e.overlay=!1,e.slidePanel=!1;var s=a.allMurals.query();s.$promise.then(function(i){e.data=i,_.each(e.data,function(i,t){e.markers.push(e.createMural(i,t)),i.image&&e.imageLocations.push("https://data.baltimorecity.gov/views/zqh4-9ud5/files/"+i.image.file_id+"?filename="+i.image.filename)}),o.preloadImages(e.imageLocations).then(function(){e.isLoading=!1,e.isSuccessful=!0,console.info("Preload Successful")},function(i){e.isLoading=!1,e.isSuccessful=!1,console.error("Image Failed",i),console.info("Preload Failure")},function(i){e.percentLoaded=i.percent,console.info("Percent loaded:",i.percent)})}),e.slideToggle=function(){e.slidePanel=!e.slidePanel,e.favorites=a.getFavorites()},e.createMural=function(e,i){var e={id:i,latitude:e.location_1.latitude,longitude:e.location_1.longitude,address:e.location,image:e.image,title:e.artistfirstname+" "+e.artistlastname,isFavorite:!1,icon:"assets/images/mural.png"};return e},e.close=function(){e.overlay=!e.overlay},e.addFavorite=function(e){e.isFavorite=!0,e.icon="assets/images/favoriteMural.png",a.addMural(e),console.log(e)},e.removeFavorite=function(e){e.isFavorite=!1,e.icon="assets/images/mural.png",a.removeMural(e)},e.showOverlay=function(i){e.overlay=!e.overlay,e.map.window.model=i},t.then(function(){e.map={center:{latitude:39.29,longitude:-76.61},zoom:12,events:{bounds_changed:function(i){e.$apply(function(){mapRef=i})}},markers:e.markers,markersEvents:{click:function(i,t,a){console.log(a),e.showOverlay(a)}},window:{marker:{},show:!1,closeClick:function(){this.show=!1},options:{}},control:{}},e.options={scrollwheel:!1,mapTypeId:"roadmap",mapTypeControl:!1,overviewMapControl:!1,streetViewControl:!1,maxZoom:20,minZoom:11,styles:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:40}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{saturation:-10},{lightness:30}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:10}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:60}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]}]},e.polygons=[{id:1,path:[{latitude:39.371957,longitude:-76.711294},{latitude:39.371972,longitude:-76.529674},{latitude:39.209623,longitude:-76.529858},{latitude:39.197233,longitude:-76.549725},{latitude:39.208121,longitude:-76.583673},{latitude:39.234395,longitude:-76.611611},{latitude:39.277838,longitude:-76.711161},{latitude:39.371957,longitude:-76.711294}],stroke:{color:"#FF0000",weight:3},editable:!1,draggable:!1,geodesic:!1,visible:!0,fill:{color:"#000",opacity:.1}}];var t=angular.element(i);t.bind("resize",function(){google.maps.event.addDomListener(window,"resize",function(){var i=e.map.control.getGMap(),t={lat:e.map.center.latitude,lng:e.map.center.longitude};i.panTo(t)})}),e.map.window.options.pixelOffset=new google.maps.Size(0,-35,"px","px")})}]),angular.module("baltimoreMurals").factory("preloader",["$q","$rootScope",function(e,i){function t(i){console.log("PRELOADER!",i),this.imageLocations=i,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=e.defer(),this.promise=this.deferred.promise}return t.preloadImages=function(e){var i=new t(e);return i.load()},t.prototype={constructor:t,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var e=0;e<this.imageCount;e++)this.loadImageLocation(this.imageLocations[e]);return this.promise},handleImageError:function(e){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(e))},handleImageLoad:function(e){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:e}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))},loadImageLocation:function(e){var t=this,a=$(new Image).load(function(e){i.$apply(function(){t.handleImageLoad(e.target.src),t=a=e=null})}).error(function(e){i.$apply(function(){t.handleImageError(e.target.src),t=a=e=null})}).prop("src",e)}},t}]),angular.module("baltimoreMurals").factory("Murals",["$resource",function(e){var i=[],t=function(e){i.push(e)},a=function(e){var t=i.indexOf(e);i.splice(t,1)},o=function(){return i};return{allMurals:e("https://data.baltimorecity.gov/resource/zqh4-9ud5.json"),addMural:t,removeMural:a,getFavorites:o}}]),angular.module("baltimoreMurals").run(["$templateCache",function(e){e.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div ng-switch="isLoading"><div ng-switch-when="true"><div class="cssload-loading"><div class="cssload-finger cssload-finger-1"><div class="cssload-finger-item"><span></span><i></i></div></div><div class="cssload-finger cssload-finger-2"><div class="cssload-finger-item"><span></span><i></i></div></div><div class="cssload-finger cssload-finger-3"><div class="cssload-finger-item"><span></span><i></i></div></div><div class="cssload-finger cssload-finger-4"><div class="cssload-finger-item"><span></span><i></i></div></div><div class="cssload-last-finger"><div class="cssload-last-finger-item"><i></i></div></div><h1>{{ percentLoaded }}%</h1></div></div><div ng-switch-when="false" ng-switch="isSuccessful"><div ng-switch-when="true"><ui-gmap-google-map center="map.center" zoom="map.zoom" options="options" control="map.control"><ui-gmap-polygon static="true" ng-repeat="p in polygons track by p.id" path="p.path" stroke="p.stroke" visible="p.visible" geodesic="p.geodesic" fill="p.fill" fit="false" editable="p.editable" draggable="p.draggable"></ui-gmap-polygon><ui-gmap-markers models="map.markers" coords="\'self\'" docluster="false" fit="\'true\'" icon="\'icon\'" events="map.markersEvents" options="\'options\'"></ui-gmap-markers></ui-gmap-google-map><div ng-include="\'components/info_window/info_window.html\'"></div></div><div ng-switch-when="false"><strong>Oops</strong>: Something when wrong :( Please refresh the browser.</div></div></div>'),e.put("components/info_window/info_window.html",'<div class="overlay" ng-class="{\'show\': overlay }"><div class="overlay-box"><div class="close-overlay" ng-click="close()"><i class="fa fa-times-circle-o"></i></div><div class="overlay-box-info"><h1>{{ map.window.model.title }}</h1><p>{{ map.window.model.address }}</p></div><div class="overlay-box-image"><img ng-src="https://data.baltimorecity.gov/views/zqh4-9ud5/files/{{ map.window.model.image.file_id }}?filename={{ map.window.model.image.filename}}" ng-if="map.window.model.image"><h1 ng-if="!map.window.model.image">Sorry, there is no image.</h1></div></div></div>'),e.put("components/navbar/navbar.html",'<nav class="navbar"><a href="https://kencrocken.github.io">Murals of Baltimore <span class="small">kencrocken.github.io</span></a></nav>')}]);